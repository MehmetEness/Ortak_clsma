{% extends "base.html" %}
{% load static %}
{% block css_files %}
    <link rel="stylesheet" href="{% static 'sales_offer_navrss.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"/>
    <link rel="stylesheet" href="{% static 'sales_offersrr.css' %}">
    <style>
    #id_Offer_Comment_Card{
    }
    input[type="file"] {
      cursor: pointer !important;
      font: 300 14px sans-serif;
      color:#9e9e9e;
      width: 0px !important;
    }
    input[type="file"]::-webkit-file-upload-button
    {
      font: 300 14px  sans-serif;
      background: linear-gradient(135deg, #71b7e6, #191970);
      border: 0;
      padding: 12px 25px;
      cursor: pointer;
      color: #fff;
      text-transform: uppercase;
    }
    
    input[type="file"]::-ms-browse {
      font: 300 14px 'Roboto', sans-serif;
      background: linear-gradient(135deg, #71b7e6, #191970);
      border: 0;
      padding: 12px 25px;
      cursor: pointer;
      color: #fff;
      text-transform: uppercase;
    }
  
  /* Stilize edilmiş düğme görünümü */
  .input-box label {
    background-color: #3498db;
    color: white;
    padding: 10px 15px;
    border-radius: 5px;
    cursor: pointer;
  }
  </style>
  <style>
    .inputfile {
      width: 0.1px;
      height: 0.1px;
      opacity: 0;
      overflow: hidden;
      position: absolute;
      z-index: -1;
  }
  
  .inputfile + label {
      width: 49%;
      font-size: 12px;
      /* 20px */
      font-weight: 600;
      text-overflow: ellipsis;
      white-space: nowrap;
      cursor: pointer;
      display: inline-block;
      overflow: hidden;
      padding: 5px 10px;
      /* 10px 20px */
  }
  
  
  
  .inputfile:focus + label,
  .inputfile.has-focus + label {
      outline: 1px dotted #000;
      outline: -webkit-focus-ring-color auto 5px;
  }
  
  .inputfile + label svg {
      width: 1em;
      height: 1em;
      vertical-align: middle;
      fill: currentColor;
      margin-top: -0.25em;
      margin-right: 0.25em;
  }
  
  
  .inputfile-1 + label {
      color: #f1e5e6;
      background: linear-gradient(135deg, #71b7e6, #191970);
  }
  .inputfile-2 + label {
      color: #f1e5e6;
      background: linear-gradient(135deg, #71b7e6, #191970);
  }
  .details{
    position: absolute;
    top: 10px;
    left: 30%;
  }
  #submit_btn{
    position: absolute;
    bottom: 10px;
    left: 40%;
  }
  #file_label{
    position: absolute;
    left: 50%;
    top: 50%;
    transform: translate(-50%, -50%);
    border-radius: 5px;
  }


  .file_upload{  
    width: 100%;
    height: 100vh;
    background: rgba(0, 0, 0, 0.8);
    color: #000;
  position: absolute;     
  
  
  z-index: 11123123123;
}
.file_upload .container{
  position: relative;
  background-color: #fff;
  border: 3px solid #18283b;
  border-radius: 10px;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 350px;
  height: 200px;
  display: flex;
  justify-content: center;
  align-items: center;
}
#clientFirmaAdd-modal{
  cursor: pointer;
  position: absolute;
  right: 10px;
  top: 10px;
}
.file_input{
  display: none;
}
.file_upload #submit_btn{
  position: absolute;
  bottom: 5%;
  left: 50%;
  transform: translate(-50%, -50%);
  height: 30px;
    width: 250px;
    outline: none;
    color: #fff;
    border: none;
    font-size: 18px;
    font-weight: 500;
    letter-spacing: 1px;
    border-radius: 5px;
    background: linear-gradient(135deg, #71b7e6, #191970);
}
.file_upload .details{
  position: absolute;
  top: 15%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 18px;
  font-weight: 700;
}
.right-menu{
   width:100%;
}
#nav-bar{
  display:none;
}
  
  
  </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.1/Sortable.min.js" integrity="sha512-3N7dD+tlndNxwAC0PwGNWnnEpzHQwgNl6/c9XW6+nqptoMhbI9Rb6kQiUFtYmXrox60oIELVSFAO0dCSfKb2tw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    {% endblock %}
    {% block title %} Sales Offer {% endblock %}
    {% block content %}
  <div class="body-div">
  {% include 'partials/_left_nav_bar.html' %}
  <div style="display: none;" class="file_upload">
    <div class="container">
      <h3 id="clientFirmaAdd-modal" class="modal-kapat">X</h3>
      <form id="file-form" enctype="multipart/form-data">
        <span class="details"></span>
              <input style="display: none;" type="file" name="inputfile file_input" id="id_file_up" class="inputfile inputfile-1" />
              <label id="file_label" for="id_file_up">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="17" viewBox="0 0 20 17"><path d="M10 0l-5.2 4.9h3.3v5.1h3.8v-5.1h3.3l-5.2-4.9zm9.3 11.5l-3.2-2.1h-2l3.4 2.6h-3.5c-.1 0-.2.1-.2.1l-.8 2.3h-6l-.8-2.2c-.1-.1-.1-.2-.2-.2h-3.6l3.4-2.6h-2l-3.2 2.1c-.4.3-.7 1-.6 1.5l.6 3.1c.1.5.7.9 1.2.9h16.3c.6 0 1.1-.4 1.3-.9l.6-3.1c.1-.5-.2-1.2-.7-1.5z"/></svg> 
                  <span id="details_span"></span></label>
             
        <div class="button">
          <input style="cursor: pointer;" id="submit_btn" type="submit" value="Kaydet" />
        </div>
      </form>
    </div>
  </div>
      <div class="right-menu">         
        <div class="top-menu">  
          <div>
            <button id="hamburger_btn1" style="margin: 0; margin-left: 20px; display: none;"><i class="fa-solid fa-bars"></i></button>   
            <button id="hamburger_btn2" style="margin: 0; margin-left: 20px;"><i class="fa-solid fa-bars"></i></button>         
            <span>Satış Teklif</span> 
          </div>   
          <ul class="top-menu-ul">
            <li id="list">Liste</li>           
            <li id="waiting_job">Bekleyen İşler</li> 
            <li id="sale_time">Satış Süreci</li>
            <li id="losing_job">Kaybedilen İşler</li>
            <li id="won_job">Kazanılan İşler</li>
          </ul> 
          <button> <a href="{% url 'sales_offer_add' %}">Yeni Satış</a></button>
        </div>   
        <div class="main-container">
          <div class="titles">
            <div class="title">
              <p>Potansiyel Müşteri</p>                     
            </div>
            <div class="title">
              <p>Maliyet Hesaplama</p>
            </div>
            <div class="title">
              <p>Fiyat Belirleme</p>
            </div>
            <div class="title">
              <p>Teklif Hazırlama</p>
            </div>
            <div class="title">
              <p>Teklif Hazır</p>
            </div>
            <div class="title">
              <p>Teklif Sunuldu</p>
            </div>
            <div class="title">
              <p>Sunum Sonrası Görüşme</p>
            </div>
            
            
          </div>
          <div class="sales_container container">         
              <div class="rows" data-situation="Potansiyel Müşteri">    
                    <div style="background-color: #D0DDFB;" class="total-cash">
                      <span>$ {{potential_customers_cost}}</span>
                      <span>({{potential_customers_count}})</span>
                    </div>       
                    {% for card in sales_offer_card %}
                    {%if card.Situation_Card == 'Potansiyel Müşteri' and card.Is_Lost == False and card.Is_Gain == False and card.Is_late == False %}
                    <div id="{{ card.id }}" class="card" draggable="true" data-situation="{{ card.Situation_Card }}">
                      <p class="bold700">{{card.Client_Card}}</p>
                      <p>{{card.Offer_Subject_Card}} #({{card.id}})</p>
                      <p>{{card.Date_Card}}</p>
                      <div class="boxes">
                        <p>$ {{card.Cost_NotIncludingKDV_Card}}</p>
                        <p>{{card.UnitCost_NotIncludingKDV}} USD/kWp</p>
                      </div>   
                      <div class="boxes">             
                      <p>{{card.DC_Power_Card}} kWp</p>
                      <p>{{card.Terrain_Roof_Card}}</p>
                      </div>
                      <div class="boxes">
                        <div class="buttons">
                          {% if card.M_File_Card %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.M_File_Card.url }}')">M1</button>
                          {% else %}
                          <button class="mb mr-3">M1</button>
                          {% endif %}                              
                          {% if card.M_File_Card_2 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.M_File_Card_2.url }}')">M2</button>
                          {% else %}
                          <button class="mb mr-3">M2</button>
                          {% endif %}                          
                          {% if card.M_File_Card_3 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.M_File_Card_3.url }}')">M3</button>
                          {% else %}
                          <button class="mb mr-3">M3</button>
                          {% endif %}                  
                            </div>
                        <div class="buttons">
                          {% if card.Offer_File_Card %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card.url }}')">T1</button>
                          {% else %}
                          <button class="mb mr-3">T1</button>
                          {% endif %}                            
                          {% if card.Offer_File_Card_2 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card_2.url }}')">T2</button>
                          {% else %}
                          <button class="mb mr-3">T2</button>
                          {% endif %}                          
                          {% if card.Offer_File_Card_3 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card_3.url }}')">T3</button>
                          {% else %}
                          <button class="mb mr-3">T3</button>
                          {% endif %}                          
                          {% if card.Offer_File_Card_4 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card_4.url }}')">T4</button>
                          {% else %}
                          <button class="mb mr-3">T4</button>
                          {% endif %}
                          {% if card.Offer_File_Card_5 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card_5.url }}')">T5</button>
                          {% else %}
                          <button class="mb mr-3">T5</button>
                          {% endif %}                        
                        </div>
                      </div>
                      <div class="flex-row">
                        
                        <p class="eclipse"><span class="bold500">Yorum: </span>{{card.Offer_Comment_Card}}</p>
                      </div>
                      <div class="card-menu">
                        <i class="fa-solid fa-ellipsis card_menu-btn1"></i>
                        <i style="display: none;" class="fa-solid fa-ellipsis card_menu-btn2"></i>
                        <ul class="card_menu">
                          <li><a href="{% url 'sales_offer_edit' sales_offer_id=card.id %}">Düzenle</a></li>
                          <li onclick="lostCard({{ card.id }})">Kaybedildi</li>
                          <li onclick="gainCard({{ card.id }})">Kazanıldı</li>
                          <li onclick="waitCard({{ card.id }})">Bekleyen</li>
                              <li onclick="reviseCard({{ card.id }})"><a href="{% url 'sales_offer_edit' sales_offer_id=card.id %}">Revize </a></li>
                          <li onclick="deleteCard({{ card.id }})">Sil</li>
                        </ul>
                      </div> 
                    </div>
                    {% endif %}
                    {% endfor %}
              </div>
              <div class="rows" data-situation="Maliyet Hesaplama">
                    <div style="background-color: #9DB8FB;" class="total-cash">
                      <span>$ {{cost_customers_cost}}</span>
                      <span>({{cost_customers_count}})</span>
                    </div> 
                    {% for card in sales_offer_card %}
                    {%if card.Situation_Card == 'Maliyet Hesaplama' and card.Is_Lost == False and card.Is_Gain == False and card.Is_late == False %}

                    <div id="{{ card.id }}" class="card" draggable="true" data-situation="{{ card.Situation_Card }}">
                      <p class="bold700">{{card.Client_Card}}</p>
                      <p>{{card.Offer_Subject_Card}} #({{card.id}})</p>
                      <p>{{card.Date_Card}}</p>
                      <div class="boxes">
                        <p>$ {{card.Cost_NotIncludingKDV_Card}}</p>
                        <p>{{card.UnitCost_NotIncludingKDV}} USD/kWp</p>
                      </div>   
                      <div class="boxes">             
                      <p>{{card.DC_Power_Card}} kWp</p>
                      <p>{{card.Terrain_Roof_Card}}</p>
                      </div>
                      <div class="boxes">
                        <div class="buttons">
                          {% if card.M_File_Card %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.M_File_Card.url }}')">M1</button>
                          {% else %}
                          <button class="mb mr-3">M1</button>
                          {% endif %}                              
                          {% if card.M_File_Card_2 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.M_File_Card_2.url }}')">M2</button>
                          {% else %}
                          <button class="mb mr-3">M2</button>
                          {% endif %}                          
                          {% if card.M_File_Card_3 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.M_File_Card_3.url }}')">M3</button>
                          {% else %}
                          <button class="mb mr-3">M3</button>
                          {% endif %}                  
                            </div>
                        <div class="buttons">
                          {% if card.Offer_File_Card %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card.url }}')">T1</button>
                          {% else %}
                          <button class="mb mr-3">T1</button>
                          {% endif %}                            
                          {% if card.Offer_File_Card_2 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card_2.url }}')">T2</button>
                          {% else %}
                          <button class="mb mr-3">T2</button>
                          {% endif %}                          
                          {% if card.Offer_File_Card_3 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card_3.url }}')">T3</button>
                          {% else %}
                          <button class="mb mr-3">T3</button>
                          {% endif %}                          
                          {% if card.Offer_File_Card_4 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card_4.url }}')">T4</button>
                          {% else %}
                          <button class="mb mr-3">T4</button>
                          {% endif %}
                          {% if card.Offer_File_Card_5 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card_5.url }}')">T5</button>
                          {% else %}
                          <button class="mb mr-3">T5</button>
                          {% endif %}                        
                        </div>
                      </div>
                      <div class="flex-row">
                        
                        <p class="eclipse"><span class="bold500">Yorum: </span>{{card.Offer_Comment_Card}}</p>
                      </div>
                      <div class="card-menu">
                        <i class="fa-solid fa-ellipsis card_menu-btn1"></i>
                        <i style="display: none;"  class="fa-solid fa-ellipsis card_menu-btn2"></i>
                        <ul class="card_menu">
                          <li><a href="{% url 'sales_offer_edit' sales_offer_id=card.id %}">Düzenle</a></li>
                          <li onclick="lostCard({{ card.id }})">Kaybedildi</li>
                          <li onclick="gainCard({{ card.id }})">Kazanıldı</li>
                          <li onclick="waitCard({{ card.id }})">Bekleyen</li>
                              <li onclick="reviseCard({{ card.id }})"><a href="{% url 'sales_offer_edit' sales_offer_id=card.id %}">Revize </a></li>
                          <li onclick="deleteCard({{ card.id }})">Sil</li>
                        </ul>
                      </div> 
                    </div>
                

                    {% endif %}
                    {% endfor %}
              </div>
              <div class="rows" data-situation="Fiyat Belirleme">
                    <div style="background-color: #F5FCD9;" class="total-cash">
                      <span>$ {{price_customers_cost}}</span>
                      <span>({{price_customers_count}})</span>
                    </div> 
                    {% for card in sales_offer_card %}
                    {%if card.Situation_Card == 'Fiyat Belirleme' and card.Is_Lost == False and card.Is_Gain == False and card.Is_late == False %}

                    <div id="{{ card.id }}" class="card" draggable="true" data-situation="{{ card.Situation_Card }}">
                      <p class="bold700">{{card.Client_Card}}</p>
                      <p>{{card.Offer_Subject_Card}} #({{card.id}})</p>
                      <p>{{card.Date_Card}}</p>
                      <div class="boxes">
                        <p>$ {{card.Cost_NotIncludingKDV_Card}}</p>
                        <p>{{card.UnitCost_NotIncludingKDV}} USD/kWp</p>
                      </div>   
                      <div class="boxes">             
                      <p>{{card.DC_Power_Card}} kWp</p>
                      <p>{{card.Terrain_Roof_Card}}</p>
                      </div>
                      <div class="boxes">
                        <div class="buttons">
                          {% if card.M_File_Card %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.M_File_Card.url }}')">M1</button>
                          {% else %}
                          <button class="mb mr-3">M1</button>
                          {% endif %}                              
                          {% if card.M_File_Card_2 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.M_File_Card_2.url }}')">M2</button>
                          {% else %}
                          <button class="mb mr-3">M2</button>
                          {% endif %}                          
                          {% if card.M_File_Card_3 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.M_File_Card_3.url }}')">M3</button>
                          {% else %}
                          <button class="mb mr-3">M3</button>
                          {% endif %}                  
                            </div>
                        <div class="buttons">
                          {% if card.Offer_File_Card %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card.url }}')">T1</button>
                          {% else %}
                          <button class="mb mr-3">T1</button>
                          {% endif %}                            
                          {% if card.Offer_File_Card_2 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card_2.url }}')">T2</button>
                          {% else %}
                          <button class="mb mr-3">T2</button>
                          {% endif %}                          
                          {% if card.Offer_File_Card_3 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card_3.url }}')">T3</button>
                          {% else %}
                          <button class="mb mr-3">T3</button>
                          {% endif %}                          
                          {% if card.Offer_File_Card_4 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card_4.url }}')">T4</button>
                          {% else %}
                          <button class="mb mr-3">T4</button>
                          {% endif %}
                          {% if card.Offer_File_Card_5 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card_5.url }}')">T5</button>
                          {% else %}
                          <button class="mb mr-3">T5</button>
                          {% endif %}

                        </div>
                      </div>
                      <div class="flex-row">
                        
                        <p class="eclipse"><span class="bold500">Yorum: </span>{{card.Offer_Comment_Card}}</p>
                      </div>
                      <div class="card-menu">
                        <i class="fa-solid fa-ellipsis card_menu-btn1"></i>
                        <i style="display: none;" class="fa-solid fa-ellipsis card_menu-btn2"></i>
                        <ul class="card_menu">
                          <li><a href="{% url 'sales_offer_edit' sales_offer_id=card.id %}">Düzenle</a></li>
                          <li onclick="lostCard({{ card.id }})">Kaybedildi</li>
                          <li onclick="gainCard({{ card.id }})">Kazanıldı</li>
                          <li onclick="waitCard({{ card.id }})">Bekleyen</li>
                              <li onclick="reviseCard({{ card.id }})"><a href="{% url 'sales_offer_edit' sales_offer_id=card.id %}">Revize </a></li>
                          <li onclick="deleteCard({{ card.id }})">Sil</li>
                        </ul>
                      </div> 
                    </div>
                    {% endif %}
                    {% endfor %}
                    
              </div>
              <div class="rows" data-situation="Teklif Hazırlama">
                    <div style="background-color: #FEF29A;" class="total-cash">
                      <span>$ {{offer_customers_cost}}</span>
                      <span>({{offer_customers_count}})</span>
                    </div> 
                    {% for card in sales_offer_card %}
                    {%if card.Situation_Card == 'Teklif Hazırlama' and card.Is_Lost == False and card.Is_Gain == False and card.Is_late == False %}

                    <div id="{{ card.id }}" class="card" draggable="true" data-situation="{{ card.Situation_Card }}">
                      <p class="bold700">{{card.Client_Card}}</p>
                      <p>{{card.Offer_Subject_Card}} #({{card.id}})</p>
                      <p>{{card.Date_Card}}</p>
                      <div class="boxes">
                        <p>$ {{card.Cost_NotIncludingKDV_Card}}</p>
                        <p>{{card.UnitCost_NotIncludingKDV}} USD/kWp</p>
                      </div>   
                      <div class="boxes">             
                      <p>{{card.DC_Power_Card}} kWp</p>
                      <p>{{card.Terrain_Roof_Card}}</p>
                      </div>
                      <div class="boxes">
                        <div class="buttons">
                          {% if card.M_File_Card %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.M_File_Card.url }}')">M1</button>
                          {% else %}
                          <button class="mb mr-3">M1</button>
                          {% endif %}                              
                          {% if card.M_File_Card_2 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.M_File_Card_2.url }}')">M2</button>
                          {% else %}
                          <button class="mb mr-3">M2</button>
                          {% endif %}                          
                          {% if card.M_File_Card_3 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.M_File_Card_3.url }}')">M3</button>
                          {% else %}
                          <button class="mb mr-3">M3</button>
                          {% endif %}                  
                            </div>
                        <div class="buttons">
                          {% if card.Offer_File_Card %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card.url }}')">T1</button>
                          {% else %}
                          <button class="mb mr-3">T1</button>
                          {% endif %}                            
                          {% if card.Offer_File_Card_2 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card_2.url }}')">T2</button>
                          {% else %}
                          <button class="mb mr-3">T2</button>
                          {% endif %}                          
                          {% if card.Offer_File_Card_3 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card_3.url }}')">T3</button>
                          {% else %}
                          <button class="mb mr-3">T3</button>
                          {% endif %}                          
                          {% if card.Offer_File_Card_4 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card_4.url }}')">T4</button>
                          {% else %}
                          <button class="mb mr-3">T4</button>
                          {% endif %}
                          {% if card.Offer_File_Card_5 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card_5.url }}')">T5</button>
                          {% else %}
                          <button class="mb mr-3">T5</button>
                          {% endif %}

                        </div>
                      </div>
                      <div class="flex-row">
                        
                        <p class="eclipse"><span class="bold500">Yorum: </span>{{card.Offer_Comment_Card}}</p>
                      </div>
                      <div class="card-menu">
                        <i class="fa-solid fa-ellipsis card_menu-btn1"></i>
                        <i style="display: none;" class="fa-solid fa-ellipsis card_menu-btn2"></i>
                        <ul class="card_menu">
                          <li><a href="{% url 'sales_offer_edit' sales_offer_id=card.id %}">Düzenle</a></li>
                          <li onclick="lostCard({{ card.id }})">Kaybedildi</li>
                          <li onclick="gainCard({{ card.id }})">Kazanıldı</li>
                          <li onclick="waitCard({{ card.id }})">Bekleyen</li>
                              <li onclick="reviseCard({{ card.id }})"><a href="{% url 'sales_offer_edit' sales_offer_id=card.id %}">Revize </a></li>
                          <li onclick="deleteCard({{ card.id }})">Sil</li>
                        </ul>
                      </div> 
                    </div>
                    {% endif %}
                    {% endfor %}
              </div>
              <div class="rows" data-situation="Teklif Hazır">
                    <div style="background-color: #FEDB1B;" class="total-cash">
                      <span>$ {{done_customers_cost}}</span>
                      <span>({{done_customers_count}})</span>
                    </div> 
                    {% for card in sales_offer_card %}
                    {%if card.Situation_Card == 'Teklif Hazır' and card.Is_Lost == False and card.Is_Gain == False and card.Is_late == False %}

                    <div id="{{ card.id }}" class="card" draggable="true" data-situation="{{ card.Situation_Card }}">
                      <p class="bold700">{{card.Client_Card}}</p>
                      <p>{{card.Offer_Subject_Card}} #({{card.id}})</p>
                      <p>{{card.Date_Card}}</p>
                      <div class="boxes">
                        <p>$ {{card.Cost_NotIncludingKDV_Card}}</p>
                        <p>{{card.UnitCost_NotIncludingKDV}} USD/kWp</p>
                      </div>   
                      <div class="boxes">             
                      <p>{{card.DC_Power_Card}} kWp</p>
                      <p>{{card.Terrain_Roof_Card}}</p>
                      </div>
                      <div class="boxes">
                        <div class="buttons">
                          {% if card.M_File_Card %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.M_File_Card.url }}')">M1</button>
                          {% else %}
                          <button class="mb mr-3">M1</button>
                          {% endif %}                              
                          {% if card.M_File_Card_2 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.M_File_Card_2.url }}')">M2</button>
                          {% else %}
                          <button class="mb mr-3">M2</button>
                          {% endif %}                          
                          {% if card.M_File_Card_3 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.M_File_Card_3.url }}')">M3</button>
                          {% else %}
                          <button class="mb mr-3">M3</button>
                          {% endif %}                  
                            </div>
                        <div class="buttons">
                          {% if card.Offer_File_Card %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card.url }}')">T1</button>
                          {% else %}
                          <button class="mb mr-3">T1</button>
                          {% endif %}                            
                          {% if card.Offer_File_Card_2 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card_2.url }}')">T2</button>
                          {% else %}
                          <button class="mb mr-3">T2</button>
                          {% endif %}                          
                          {% if card.Offer_File_Card_3 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card_3.url }}')">T3</button>
                          {% else %}
                          <button class="mb mr-3">T3</button>
                          {% endif %}                          
                          {% if card.Offer_File_Card_4 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card_4.url }}')">T4</button>
                          {% else %}
                          <button class="mb mr-3">T4</button>
                          {% endif %}
                          {% if card.Offer_File_Card_5 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card_5.url }}')">T5</button>
                          {% else %}
                          <button class="mb mr-3">T5</button>
                          {% endif %}

                        </div>
                      </div>
                      <div class="flex-row">
                        
                        <p class="eclipse"><span class="bold500">Yorum: </span>{{card.Offer_Comment_Card}}</p>
                      </div>
                      <div class="card-menu">
                        <i class="fa-solid fa-ellipsis card_menu-btn1"></i>
                        <i style="display: none;" class="fa-solid fa-ellipsis card_menu-btn2"></i>
                        <ul class="card_menu">
                          <li><a href="{% url 'sales_offer_edit' sales_offer_id=card.id %}">Düzenle</a></li>
                          <li onclick="lostCard({{ card.id }})">Kaybedildi</li>
                          <li onclick="gainCard({{ card.id }})">Kazanıldı</li>
                          <li onclick="waitCard({{ card.id }})">Bekleyen</li>
                              <li onclick="reviseCard({{ card.id }})"><a href="{% url 'sales_offer_edit' sales_offer_id=card.id %}">Revize </a></li>
                          <li onclick="deleteCard({{ card.id }})">Sil</li>
                        </ul>
                      </div> 
                    </div>
                    {% endif %}
                    {% endfor %}
              </div>
              <div class="rows" data-situation="Teklif Sunuldu">
                <div style="background-color: #98EE77;" class="total-cash">
                  <span>$ {{done_customers_cost}}</span>
                  <span>({{done_customers_count}})</span>
                </div> 
                {% for card in sales_offer_card %}
                {%if card.Situation_Card == 'Teklif Sunuldu' and card.Is_Lost == False and card.Is_Gain == False and card.Is_late == False %}

                <div id="{{ card.id }}" class="card" draggable="true" data-situation="{{ card.Situation_Card }}">
                  <p class="bold700">{{card.Client_Card}}</p>
                  <p>{{card.Offer_Subject_Card}} #({{card.id}})</p>
                  <p>{{card.Date_Card}}</p>
                  <div class="boxes">
                    <p>$ {{card.Cost_NotIncludingKDV_Card}}</p>
                    <p>{{card.UnitCost_NotIncludingKDV}} USD/kWp</p>
                  </div>   
                  <div class="boxes">             
                  <p>{{card.DC_Power_Card}} kWp</p>
                  <p>{{card.Terrain_Roof_Card}}</p>
                  </div>
                  <div class="boxes">
                    <div class="buttons">
                      {% if card.M_File_Card %}
                      <button class="mr-3 blue" onclick="openFile('{{ card.M_File_Card.url }}')">M1</button>
                      {% else %}
                      <button class="mb mr-3">M1</button>
                      {% endif %}                              
                      {% if card.M_File_Card_2 %}
                      <button class="mr-3 blue" onclick="openFile('{{ card.M_File_Card_2.url }}')">M2</button>
                      {% else %}
                      <button class="mb mr-3">M2</button>
                      {% endif %}                          
                      {% if card.M_File_Card_3 %}
                      <button class="mr-3 blue" onclick="openFile('{{ card.M_File_Card_3.url }}')">M3</button>
                      {% else %}
                      <button class="mb mr-3">M3</button>
                      {% endif %}                  
                        </div>
                    <div class="buttons">
                      {% if card.Offer_File_Card %}
                      <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card.url }}')">T1</button>
                      {% else %}
                      <button class="mb mr-3">T1</button>
                      {% endif %}                            
                      {% if card.Offer_File_Card_2 %}
                      <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card_2.url }}')">T2</button>
                      {% else %}
                      <button class="mb mr-3">T2</button>
                      {% endif %}                          
                      {% if card.Offer_File_Card_3 %}
                      <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card_3.url }}')">T3</button>
                      {% else %}
                      <button class="mb mr-3">T3</button>
                      {% endif %}                          
                      {% if card.Offer_File_Card_4 %}
                      <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card_4.url }}')">T4</button>
                      {% else %}
                      <button class="mb mr-3">T4</button>
                      {% endif %}
                      {% if card.Offer_File_Card_5 %}
                      <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card_5.url }}')">T5</button>
                      {% else %}
                      <button class="mb mr-3">T5</button>
                      {% endif %}

                    </div>
                  </div>
                  <div class="flex-row">
                    
                    <p class="eclipse"><span class="bold500">Yorum: </span>{{card.Offer_Comment_Card}}</p>
                  </div>
                  <div class="card-menu">
                    <i class="fa-solid fa-ellipsis card_menu-btn1"></i>
                    <i style="display: none;" class="fa-solid fa-ellipsis card_menu-btn2"></i>
                    <ul class="card_menu">
                      <li><a href="{% url 'sales_offer_edit' sales_offer_id=card.id %}">Düzenle</a></li>
                      <li onclick="lostCard({{ card.id }})">Kaybedildi</li>
                      <li onclick="gainCard({{ card.id }})">Kazanıldı</li>
                      <li onclick="waitCard({{ card.id }})">Bekleyen</li>
                      <li onclick="reviseCard({{ card.id }})"><a href="{% url 'sales_offer_edit' sales_offer_id=card.id %}">Revize </a></li>
                      <li onclick="deleteCard({{ card.id }})">Sil</li>
                    </ul>
                  </div> 
                </div>
                {% endif %}
                {% endfor %}
              </div>  
              <div class="rows" data-situation="Sunum Sonrası Görüşme">
                    <div style="background-color: #FDA802;" class="total-cash">
                      <span>$ {{presentation_customers_cost}}</span>
                      <span>({{presentation_customers_count}})</span>
                    </div> 
                    {% for card in sales_offer_card %}
                    {%if card.Situation_Card == 'Sunum Sonrası Görüşme' and card.Is_Lost == False and card.Is_Gain == False and card.Is_late == False %}

                    <div id="{{ card.id }}" class="card" draggable="true" data-situation="{{ card.Situation_Card }}">
                      <p class="bold700">{{card.Client_Card}}</p>
                      <p>{{card.Offer_Subject_Card}} #({{card.id}})</p>
                      <p>{{card.Date_Card}}</p>
                      <div class="boxes">
                        <p>$ {{card.Cost_NotIncludingKDV_Card}}</p>
                        <p>{{card.UnitCost_NotIncludingKDV}} USD/kWp</p>
                      </div>   
                      <div class="boxes">             
                      <p>{{card.DC_Power_Card}} kWp</p>
                      <p>{{card.Terrain_Roof_Card}}</p>
                      </div>
                      <div class="boxes">
                        <div class="buttons">
                          {% if card.M_File_Card %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.M_File_Card.url }}')">M1</button>
                          {% else %}
                          <button class="mb mr-3">M1</button>
                          {% endif %}                              
                          {% if card.M_File_Card_2 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.M_File_Card_2.url }}')">M2</button>
                          {% else %}
                          <button class="mb mr-3">M2</button>
                          {% endif %}                          
                          {% if card.M_File_Card_3 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.M_File_Card_3.url }}')">M3</button>
                          {% else %}
                          <button class="mb mr-3">M3</button>
                          {% endif %}                  
                            </div>
                        <div class="buttons">
                          {% if card.Offer_File_Card %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card.url }}')">T1</button>
                          {% else %}
                          <button class="mb mr-3">T1</button>
                          {% endif %}                            
                          {% if card.Offer_File_Card_2 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card_2.url }}')">T2</button>
                          {% else %}
                          <button class="mb mr-3">T2</button>
                          {% endif %}                          
                          {% if card.Offer_File_Card_3 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card_3.url }}')">T3</button>
                          {% else %}
                          <button class="mb mr-3">T3</button>
                          {% endif %}                          
                          {% if card.Offer_File_Card_4 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card_4.url }}')">T4</button>
                          {% else %}
                          <button class="mb mr-3">T4</button>
                          {% endif %}
                          {% if card.Offer_File_Card_5 %}
                          <button class="mr-3 blue" onclick="openFile('{{ card.Offer_File_Card_5.url }}')">T5</button>
                          {% else %}
                          <button class="mb mr-3">T5</button>
                          {% endif %}

                        </div>
                      </div>
                      <div class="flex-row">
                        
                        <p class="eclipse"><span class="bold500">Yorum: </span>{{card.Offer_Comment_Card}}</p>
                      </div>
                      <div class="card-menu">
                        <i class="fa-solid fa-ellipsis card_menu-btn1"></i>
                        <i style="display: none;" class="fa-solid fa-ellipsis card_menu-btn2"></i>
                        <ul class="card_menu">
                          <li><a href="{% url 'sales_offer_edit' sales_offer_id=card.id %}">Düzenle</a></li>
                          <li onclick="lostCard({{ card.id }})">Kaybedildi</li>
                          <li onclick="gainCard({{ card.id }})">Kazanıldı</li>
                          <li onclick="waitCard({{ card.id }})">Bekleyen</li>
                          <li onclick="reviseCard({{ card.id }})"><a href="{% url 'sales_offer_edit' sales_offer_id=card.id %}">Revize </a></li>
                          <li onclick="deleteCard({{ card.id }})">Sil</li>
                        </ul>
                      </div> 
                    </div>
                    {% endif %}
                    {% endfor %}
              </div>
        
          </div>
        </div>   
        <div style="display: none;" class="list-container container">
          <div class="lists">
            <table id="table" class="table table-sortable">
               <thead><th></th>
                  <th scope="col">Müşteri Adı</th>
                  <th scope="col">Konum</th>
                  <th scope="col">İlgili Kişi</th>
                  <th scope="col">AC Güç</th>
                  <th scope="col">DC Güç</th>
                  <th scope="col">Birim Maliyet</th>
                  <th scope="col">Toplam Maliyet</th>
                  <th scope="col">Birim Teklif</th>
                  <th scope="col">Toplam Teklif</th>
                  <th scope="col">Arazi/Çatı</th>
                  <th scope="col">Arazi Maliyeti</th>
                  <th scope="col">Arazi Dahil Birim Maliyet</th>
                  <th scope="col">Arazi Dahil Toplam Teklif</th>
                  <th scope="col">Arazi Maliyeti</th>
                  <th scope="col">Tarih</th>
                  <th scope="col">Durum</th>
               </thead>
               <tbody>
                {% for card in sales_offer_card%}
                  <tr>
                    <td ><a href="{% url 'sales_offer_revises' card_id=card.id %}"><i class="fas fa-wrench"></i></a></td>
                    <td> {{card.Client_Card}} </td>
                    <td>{{card.Location_Card}}</td>
                    <td>{{card.Person_Deal}}</td>
                    <td>{{card.AC_Power_Card}}</td>
                    <td>{{card.DC_Power_Card}}</td>
                    <td>{{card.UnitCost_NotIncludingKDV}}</td>
                    <td>{{card.Cost_NotIncludingKDV_Card}}</td>
                    <td>{{card.UnitOffer_NotIncludingKDV}}</td>
                    <td>{{card.Offer_Cost_NotIncludingKDV_Card}}</td>
                    <td>{{card.Terrain_Roof_Card}}</td>
                    <td>{{card.Roof_Cost_Card}}</td>
                    <td>{{card.Unit_Cost_with_Roof_Cost}}</td>
                    <td>{{card.Unit_Offer_with_Roof_Cost}}</td>
                    <td>{{card.Profit_Rate_Card}}</td>

                    <td>{{card.Date_Card| date:"d F y"}}</td>
                    <td>{{card.Situation_Card}}</td>
                  </tr>
                  {% endfor %}      
               </tbody>
              </table>
            </div>
        </div>
        
        <div style="display: none;" class="lost-job-container container">
          <div class="lists">
            <table id="table" class="table table-sortable">
               <thead>
                <th></th>
                <th scope="col">Müşteri Adı</th>
                <th scope="col">Konum</th>
                <th scope="col">İlgili Kişi</th>
                <th scope="col">AC Güç</th>
                <th scope="col">DC Güç</th>
                <th scope="col">Birim Maliyet</th>
                <th scope="col">Toplam Maliyet</th>
                <th scope="col">Birim Teklif</th>
                <th scope="col">Toplam Teklif</th>
                <th scope="col">Arazi/Çatı</th>
                <th scope="col">Arazi Maliyeti</th>
                <th scope="col">Arazi Dahil Birim Maliyet</th>
                <th scope="col">Arazi Dahil Toplam Teklif</th>
                <th scope="col">Arazi Maliyeti</th>
                <th scope="col">Tarih</th>
               </thead>
               <tbody>
                {% for card in sales_offer_card %}
                {% if card.Is_Lost == True %}
                  <tr>
                    <td><a onclick="reLostCard({{ card.id }})"><i class="fa-solid fa-rotate-left"></i></a></i></td>
                    <td> {{card.Client_Card}} </td>
                    <td>{{card.Location_Card}}</td>
                    <td>{{card.Person_Deal}}</td>
                    <td>{{card.AC_Power_Card}}</td>
                    <td>{{card.DC_Power_Card}}</td>
                    <td>{{card.UnitCost_NotIncludingKDV}}</td>
                    <td>{{card.Cost_NotIncludingKDV_Card}}</td>
                    <td>{{card.UnitOffer_NotIncludingKDV}}</td>
                    <td>{{card.Offer_Cost_NotIncludingKDV_Card}}</td>
                    <td>{{card.Terrain_Roof_Card}}</td>
                    <td>{{card.Roof_Cost_Card}}</td>
                    <td>{{card.Unit_Cost_with_Roof_Cost}}</td>
                    <td>{{card.Unit_Offer_with_Roof_Cost}}</td>
                    <td>{{card.Profit_Rate_Card}}</td>

                    <td>{{card.Date_Card| date:"d F y"}}</td>
                  </tr>
                  {% endif %}
                  {% endfor %}      
               </tbody>
              </table>
            </div>
        </div>
        <div style="display: none;" class="sales-container container">
          <div class="lists">
            <table id="table" class="table table-sortable">
               <thead>
                <th></th>
                <th scope="col">Müşteri Adı</th>
                <th scope="col">Konum</th>
                <th scope="col">İlgili Kişi</th>
                <th scope="col">AC Güç</th>
                <th scope="col">DC Güç</th>
                <th scope="col">Birim Maliyet</th>
                <th scope="col">Toplam Maliyet</th>
                <th scope="col">Birim Teklif</th>
                <th scope="col">Toplam Teklif</th>
                <th scope="col">Arazi/Çatı</th>
                <th scope="col">Arazi Maliyeti</th>
                <th scope="col">Arazi Dahil Birim Maliyet</th>
                <th scope="col">Arazi Dahil Toplam Teklif</th>
                <th scope="col">Arazi Maliyeti</th>
                <th scope="col">Tarih</th>
               </thead>
               <tbody>
                {% for card in sales_offer_card%}
                {% if card.Is_late == True %}
                  <tr>
                    <td onclick="reWaitCard({{ card.id }})"><a><i class="fa-solid fa-rotate-left"></i></a></i></td>
                    <td> {{card.Client_Card}} </td>
                    <td>{{card.Location_Card}}</td>
                    <td>{{card.Person_Deal}}</td>
                    <td>{{card.AC_Power_Card}}</td>
                    <td>{{card.DC_Power_Card}}</td>
                    <td>{{card.UnitCost_NotIncludingKDV}}</td>
                    <td>{{card.Cost_NotIncludingKDV_Card}}</td>
                    <td>{{card.UnitOffer_NotIncludingKDV}}</td>
                    <td>{{card.Offer_Cost_NotIncludingKDV_Card}}</td>
                    <td>{{card.Terrain_Roof_Card}}</td>
                    <td>{{card.Roof_Cost_Card}}</td>
                    <td>{{card.Unit_Cost_with_Roof_Cost}}</td>
                    <td>{{card.Unit_Offer_with_Roof_Cost}}</td>
                    <td>{{card.Profit_Rate_Card}}</td>
                    <td>{{card.Date_Card| date:"d F y"}}</td>
                  </tr>
                  {% endif %}
                  {% endfor %}      
               </tbody>
              </table>
            </div>
        </div>
        <div style="display: none;" class="won-container container">
          <div class="lists">
            <table id="table" class="table table-sortable">
               <thead>
                <th></th>
                <th scope="col">Müşteri Adı</th>
                <th scope="col">Konum</th>
                <th scope="col">İlgili Kişi</th>
                <th scope="col">AC Güç</th>
                <th scope="col">DC Güç</th>
                <th scope="col">Birim Maliyet</th>
                <th scope="col">Toplam Maliyet</th>
                <th scope="col">Birim Teklif</th>
                <th scope="col">Toplam Teklif</th>
                <th scope="col">Arazi/Çatı</th>
                <th scope="col">Arazi Maliyeti</th>
                <th scope="col">Arazi Dahil Birim Maliyet</th>
                <th scope="col">Arazi Dahil Toplam Teklif</th>
                <th scope="col">Arazi Maliyeti</th>
                <th scope="col">Tarih</th>
               </thead>
               <tbody>
                {% for card in sales_offer_card%}
                {% if card.Is_Gain == True %}
                  <tr>
                    <td onclick="reGainCard({{ card.id }})"><a><i class="fa-solid fa-rotate-left"></i></a></i></td>
                    <td> {{card.Client_Card}} </td>
                    <td>{{card.Location_Card}}</td>
                    <td>{{card.Person_Deal}}</td>
                    <td>{{card.AC_Power_Card}}</td>
                    <td>{{card.DC_Power_Card}}</td>
                    <td>{{card.UnitCost_NotIncludingKDV}}</td>
                    <td>{{card.Cost_NotIncludingKDV_Card}}</td>
                    <td>{{card.UnitOffer_NotIncludingKDV}}</td>
                    <td>{{card.Offer_Cost_NotIncludingKDV_Card}}</td>
                    <td>{{card.Terrain_Roof_Card}}</td>
                    <td>{{card.Roof_Cost_Card}}</td>
                    <td>{{card.Unit_Cost_with_Roof_Cost}}</td>
                    <td>{{card.Unit_Offer_with_Roof_Cost}}</td>
                    <td>{{card.Profit_Rate_Card}}</td>
                    <td>{{card.Date_Card| date:"d F y"}}</td>
                  </tr>
                  {% endif %}
                  {% endfor %}      
               </tbody>
              </table>
            </div>
        </div>
          
      </div>   
  </div>
  {% endblock %}

{% block js_files %} 
<!-- <script src="{% static 'tedarikcii.js' %}"></script>  -->

<!-- Elementler -->

<!-- Kaybedilen İş -->
<script>
  function openFile(url) {
      window.open(url, '_blank');  // Dosyayı yeni bir sekmede açar
  }
</script>
<script>
// Revize  işlemleri 
      function reviseCard(cardId) {
        const csrftoken = getCookie('csrftoken');

        if (!csrftoken) {
          console.error('CSRF token bulunamadı.');
          return;
        }

        fetch(`AFM/create_revise/${cardId}/`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': csrftoken,
          },
        })
        .then(response => {
          if (!response.ok) {
            throw new Error('Kaybedildi işlemi başarısızz');
          }
          return response.json();
        })
        .then(data => {
          console.log('Kaybedildi işlemi başarılı', data);
          location.reload();
        })
        .catch(error => {
          console.error('Hata:', error.message);
        });
      }

      function getCookie(name) {
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        return parts.length === 2 ? parts.pop().split(';').shift() : null;
      }

     // Wait işlemleri 
     function waitCard(cardId) {
      const csrftoken = getCookie('csrftoken');
  
      if (!csrftoken) {
        console.error('CSRF token bulunamadı.');
        return;
      }
  
      fetch(`AFM/set_card_wait/${cardId}/`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': csrftoken,
        },
      })
      .then(response => {
        if (!response.ok) {
          throw new Error('Kaybedildi işlemi başarısızz');
        }
        return response.json();
      })
      .then(data => {
        console.log('Kaybedildi işlemi başarılı', data);
        location.reload();
      })
      .catch(error => {
        console.error('Hata:', error.message);
      });
    }
  
    function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      return parts.length === 2 ? parts.pop().split(';').shift() : null;
    }
  
    function reWaitCard(cardId) {
      const csrftoken = getCookie('csrftoken');
  
      if (!csrftoken) {
        console.error('CSRF token bulunamadı.');
        return;
      }
  
      fetch(`AFM/set_card_rewait/${cardId}/`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': csrftoken,
        },
      })
      .then(response => {
        if (!response.ok) {
          throw new Error('Kaybedildi işlemi başarısızz');
        }
        return response.json();
      })
      .then(data => {
        console.log('00Kaybedildi işlemi başarılı', data);
        location.reload();
      })
      .catch(error => {
        console.error('Hata:', error.message);
      });
    }
  
    function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      return parts.length === 2 ? parts.pop().split(';').shift() : null;
    }


    // Gain işlemleri 
    function gainCard(cardId) {
      const csrftoken = getCookie('csrftoken');
  
      if (!csrftoken) {
        console.error('CSRF token bulunamadı.');
        return;
      }
  
      fetch(`AFM/set_card_gain/${cardId}/`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': csrftoken,
        },
      })
      .then(response => {
        if (!response.ok) {
          throw new Error('Kaybedildi işlemi başarısızz');
        }
        return response.json();
      })
      .then(data => {
        console.log('Kaybedildi işlemi başarılı', data);
        location.reload();
      })
      .catch(error => {
        console.error('Hata:', error.message);
      });
    }
  
    function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      return parts.length === 2 ? parts.pop().split(';').shift() : null;
    }
  
    function reGainCard(cardId) {
      const csrftoken = getCookie('csrftoken');
  
      if (!csrftoken) {
        console.error('CSRF token bulunamadı.');
        return;
      }
  
      fetch(`AFM/set_card_regain/${cardId}/`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'X-CSRFToken': csrftoken,
        },
      })
      .then(response => {
        if (!response.ok) {
          throw new Error('Kaybedildi işlemi başarısızz');
        }
        return response.json();
      })
      .then(data => {
        console.log('00Kaybedildi işlemi başarılı', data);
        location.reload();
      })
      .catch(error => {
        console.error('Hata:', error.message);
      });
    }
  
    function getCookie(name) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${name}=`);
      return parts.length === 2 ? parts.pop().split(';').shift() : null;
    }
   
   
    //Lost İşlemleri
  function lostCard(cardId) {
    const csrftoken = getCookie('csrftoken');

    if (!csrftoken) {
      console.error('CSRF token bulunamadı.');
      return;
    }

    fetch(`AFM/set_card_lost/${cardId}/`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': csrftoken,
      },
    })
    .then(response => {
      if (!response.ok) {
        throw new Error('Kaybedildi işlemi başarısızz');
      }
      return response.json();
    })
    .then(data => {
      console.log('Kaybedildi işlemi başarılı', data);
      location.reload();
    })
    .catch(error => {
      console.error('Hata:', error.message);
    });
  }

  function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    return parts.length === 2 ? parts.pop().split(';').shift() : null;
  }

  function reLostCard(cardId) {
    const csrftoken = getCookie('csrftoken');

    if (!csrftoken) {
      console.error('CSRF token bulunamadı.');
      return;
    }

    fetch(`AFM/set_card_relost/${cardId}/`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': csrftoken,
      },
    })
    .then(response => {
      if (!response.ok) {
        throw new Error('Kaybedildi işlemi başarısızz');
      }
      return response.json();
    })
    .then(data => {
      console.log('00Kaybedildi işlemi başarılı', data);
      location.reload();
    })
    .catch(error => {
      console.error('Hata:', error.message);
    });
  }

  function getCookie(name) {
    const value = `; ${document.cookie}`;
    const parts = value.split(`; ${name}=`);
    return parts.length === 2 ? parts.pop().split(';').shift() : null;
  }
</script>

<!-- Silinen İş -->
<script>
  // CSRF token'ını al
  const csrfCookie = document.cookie.split('; ').find(row => row.startsWith('csrftoken='));
  const csrfToken = csrfCookie ? csrfCookie.split('=')[1] : null;

  function deleteCard(cardId) {
    if (!csrfToken) {
      console.error('CSRF token bulunamadı.');
      return;
    }

    // Silme işlemi için bir HTTP isteği yap
    fetch(`AFM/delete_salesoffercard/${cardId}/`, {
      method: 'DELETE',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': csrfToken,
      },
    })
    .then(response => {
      if (!response.ok) {
        location.reload();
        throw new Error('Silme işlemi başarısız');
      }
      return response.json();
    })
    .then(data => {
      console.log('Silme başarılı', data);
      location.reload();
    })
    .catch(error => {
      console.error('Hata:', error.message);
    });
  }
</script>

<script>
  let rows = document.querySelectorAll(".rows");
  </script>
  <!-- Functions -->
  <script>
    function formatNumber2(number) {
      return new Intl.NumberFormat('en-US', { minimumFractionDigits:2 , maximumFractionDigits: 2 }).format(number.toFixed(2));
    }
    function formatNumber0(number) {
      return new Intl.NumberFormat('en-US', {maximumFractionDigits: 0 }).format(number.toFixed(2));
    }
  </script>
  <!--      ****  Sürükle Bırak  ****       -->
  <script>
    var p = document.querySelectorAll(".card");
    var choice = document.querySelectorAll(".rows");
    var dragItem = null;
  
    for(var i of p){
        i.addEventListener("dragstart", dragStart);
        i.addEventListener("dragend", dragEnd);
    }
  
    function dragStart(){
        dragItem = this;
        setTimeout(()=>this.style.display = "none", 0);
    }
    function dragEnd(){            
        setTimeout(()=>this.style.display = "flex", 0);        
        cardFormat();
    }
  
    for(j of choice){
        j.addEventListener("dragover", dragOver);
        j.addEventListener("dragenter", dragEnter);
        j.addEventListener("dragleave", dragLeave);
        j.addEventListener("drop", Drop);
    }
      function Drop() {
        this.append(dragItem);
        this.style.border = "none"
        this.style.borderRight = "1px solid rgba(0, 0, 0, 0.2)";

        var targetRowSituation = this.dataset.situation;
        
        // Get the card ID from the dragged item
        var cardId = dragItem.id;

        // Make an AJAX request to update the card's situation
        var xhr = new XMLHttpRequest();
        xhr.open("POST", "{% url 'update_card_situation' %}", true);
        xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");

        xhr.onreadystatechange = function () {
            if (xhr.readyState === 4 && xhr.status === 200) {
                // Update the card's situation on the client side
                dragItem.dataset.situation = targetRowSituation;
            }
        };

        xhr.send(JSON.stringify({ card_id: cardId, new_situation: targetRowSituation }));        
    }
    
    function dragOver(e){
        e.preventDefault();
        this.style.border = "2px solid rgba(0, 0, 0, 0.3)"
    }
    function dragEnter(e){
        e.preventDefault();
    }
    function dragLeave(){
        this.style.border = "none"
        this.style.borderRight = "1px solid rgba(0, 0, 0, 0.2)";
    }
  </script>
  <!-- Top Menu Tıklama -->
  <script>
    // JavaScript kullanarak tıklanan elemana "clicked" sınıfını ekleyen fonksiyon
    document.addEventListener("DOMContentLoaded", function () {
      var menuItems = document.querySelectorAll(".top-menu-ul li");
  
      // İlk li elemanına otomatik olarak tıklama gerçekleştir
      menuItems[2].click();
      menuItems[2].classList.add("li-hover");
  
      menuItems.forEach(function (item) {
          item.addEventListener("click", function () {
              // Tıklanan öğeye "li-hover" sınıfını ekleyin
              menuItems.forEach(function (item) {
                  item.classList.remove("li-hover");
              });
              this.classList.add("li-hover");
          });
      });
  });
  </script>
  <script>
    'use strict';
    
    document.addEventListener('DOMContentLoaded', function () {
        var inputs = document.querySelectorAll('.inputfile-2');
    
        Array.prototype.forEach.call(inputs, function (input, index) {
            var label = input.nextElementSibling;
            var nextLabel = inputs[index + 1] ? inputs[index + 1].nextElementSibling : null;
    
            input.addEventListener('change', function () {
                if (index < inputs.length - 1 && nextLabel) {
                    nextLabel.style.display = 'inline-block';
                    inputs[index + 1].style.display = 'inline-block';
                }
            });
    
            input.addEventListener('change', function (e) {
                var label = input.nextElementSibling,
                    labelVal = label.innerHTML;
    
                var fileName = '';
                if (input.files && input.files.length > 1)
                    fileName = (input.getAttribute('data-multiple-caption') || '').replace('{count}', input.files.length);
                else
                    fileName = e.target.value.split('\\').pop();
    
                if (fileName) {
                  label.querySelector('span').innerHTML = fileName;
              } else {
                  var defaultText = 'Maliyet ' + (index + 1) + ' Dosyası seçin'; // Özel metni oluştur
                  label.querySelector('span').innerHTML = defaultText; // Etiketi güncelle   M1 Dosyası seçin
              }
            });
    
            // Check if the input initially has a file selected
            if (input.files && input.files.length > 0 && nextLabel) {
                  nextLabel.style.display = 'inline-block';
                  inputs[index + 1].style.display = 'inline-block';
              } else {
                  // Sayfa yüklendiğinde dosya adı varsa ve farklıysa labelı görünür yap
                  var defaultText = 'Maliyet ' + (index + 1) + ' Dosyası seçin';
                  var fileName = label.querySelector('span').textContent;
                  if (fileName !== defaultText) {
                      label.style.display = 'inline-block';
                  }
              }
        });
    });
    
    </script>
  <!-- Top Menu -->
  <script>
  
    let maniContainer = document.querySelector(".main-container");
    let listContainer = document.querySelector(".list-container");
    let lostJobContainer = document.querySelector(".lost-job-container");
    let salesContainer = document.querySelector(".sales-container");
    let wonContainer = document.querySelector(".won-container");
  
   document.addEventListener("DOMContentLoaded", function () {
      var listItems = document.querySelectorAll(".top-menu-ul li");
  
      listItems.forEach(function (item) {
          item.addEventListener("click", function () {
              // Tıklanan öğenin id'sini al
              var clickedItemId = this.id;
  
              // Fonksiyonu çağır ve tıklanan id'yi parametre olarak geç
              handleMenuItemClick(clickedItemId);
          });
      });
  
      // Tıklanan öğeye göre çalışacak fonksiyon
      function handleMenuItemClick(clickedItemId) {
          switch (clickedItemId) {
              case "list":
                  listContainer.style.display = "flex";
                  maniContainer.style.display = "none";
                  salesContainer.style.display = "none";
                  lostJobContainer.style.display = "none";
                  wonContainer.style.display = "none";
                  break;
              case "sale_time":
                  listContainer.style.display = "none";
                  maniContainer.style.display = "flex";
                  salesContainer.style.display = "none";
                  lostJobContainer.style.display = "none";
                  wonContainer.style.display = "none";
                  break;
              case "waiting_job":
                  listContainer.style.display = "none";
                  maniContainer.style.display = "none";
                  salesContainer.style.display = "flex";
                  lostJobContainer.style.display = "none";
                  wonContainer.style.display = "none";
                  break;
              case "losing_job":
                  listContainer.style.display = "none";
                  maniContainer.style.display = "none";
                  salesContainer.style.display = "none";
                  lostJobContainer.style.display = "flex";
                  wonContainer.style.display = "none";
                  break;
              case "won_job":
                  listContainer.style.display = "none";
                  maniContainer.style.display = "none";
                  salesContainer.style.display = "none";
                  lostJobContainer.style.display = "none";
                  wonContainer.style.display = "flex";
                  break;
              default:
                  console.log("Bilinmeyen öğe tıklandı!");
                  break;
          }
      }
  });
  
  
  </script>
  <!-- Toplama İşlemleri -->
  <script>
    
    cardFormat();

  function cardFormat() {
    rows.forEach(function (row) {
        let cards = row.querySelectorAll(".card");
        let totalCashSpan = row.querySelector('.total-cash span:nth-child(1)');
        let customersCountSpan = row.querySelector('.total-cash span:nth-child(2)');
        let totalCash = 0;

        cards.forEach(function (card) {
            let USDSpan = card.querySelector(".boxes:first-of-type p:first-of-type");
            let unitSpan = card.querySelector(".boxes:first-of-type p:nth-of-type(2)");
            let powerSpan = card.querySelector(".boxes:nth-of-type(2) p:nth-of-type(1)");

            // Parse the text content to float, handling possible 'null' or 'undefined'  
            
            let currentUSD = parseFloat(USDSpan.textContent.replace(/[^\d.-]/g, '')) || 0;
            let currentUnit = parseFloat(unitSpan.textContent.replace(/[^\d.-]/g, '')) || 0;
            let powerCount = parseFloat(powerSpan.textContent.replace(/[^\d.-]/g, '')) || 0;

            USDSpan.textContent = "$" + formatNumber2(currentUSD);
            unitSpan.textContent = formatNumber0(currentUnit) + " USD/kWp";
            powerSpan.textContent = formatNumber0(powerCount) + " kWp";

            totalCash += currentUSD;
        });
    
      totalCashSpan.textContent ="$" + formatNumber2(totalCash);
      customersCountSpan.textContent = `(${String(cards.length)})`;
      
    });
  
  }
  
  </script>
  <!-- Card Menu -->
  <script>

    var cardMenuBtn1 = document.querySelectorAll(".card_menu-btn1");
    var cardMenuBtn2;
    let cardMenu;
    let btn1;
    var boolClick = false;

  cardMenuBtn1.forEach(btn => {
  btn.addEventListener('click', function() {
    let card = this.closest('.card');
    cardMenuBtn2 = card.querySelector(".card_menu-btn2");    
    cardMenu = card.querySelector('.card_menu');
    btn1 = btn;
    boolClick = true;
          
    cardMenu.style.display = "block";
    btn.style.display = "none"
    cardMenuBtn2.style.display = "block"
     
     cardMenuBtn2.addEventListener("click", function() {
       cardMenu.style.display = "none";
       cardMenuBtn2.style.display = "none"
       btn.style.display = "block"
       cardMenuBtn2 = null;
       cardMenu = null;
       btn1 = null;
       boolClick = false;
     });
  });
});
  // Sayfa üzerinde herhangi bir yere tıklanınca
 /* document.addEventListener('click', function (event) {

    if(boolClick){
      if (cardMenuBtn2 !== null) {
      // Menüyü kapat
      cardMenu.style.display = "none";
       cardMenuBtn2.style.display = "none"
       btn1.style.display = "block"
       cardMenuBtn2 = null;
       cardMenu = null;
       btn1 = null;
    }
    }
  });*/



    

  </script>
  <!-- Liste Formatlama -->
  <script>
 document.addEventListener("DOMContentLoaded", function () {
    var numericCells = document.querySelectorAll(
      "#table td:nth-child(5), #table td:nth-child(6), #table td:nth-child(7), #table td:nth-child(8), #table td:nth-child(9), #table td:nth-child(10), #table td:nth-child(12), #table td:nth-child(13), #table td:nth-child(14), #table td:nth-child(15)"
    );
    var textCells = document.querySelectorAll(
      "#table td:nth-child(3), #table td:nth-child(4), #table td:nth-child(11), #table td:nth-child(16)"
    );
    textCells.forEach(function (cell) {
      if (cell.textContent == "None" || cell.textContent == "") {
        cell.textContent = "-";
      }
    });

    numericCells.forEach(function (cell) {
      if (cell.textContent == "None") {
        cell.textContent = "-";
      } else {
        var numericValue = parseFloat(cell.textContent.replace(/[^\d.-]/g, ""));
        cell.textContent = formatNumber2(numericValue);
      }
    });
  });

function formatNumber4(number) {
  return new Intl.NumberFormat('en-US', { minimumFractionDigits:4 , maximumFractionDigits: 4 }).format(number.toFixed(4));

}
function formatNumber2(number) {
  return new Intl.NumberFormat('en-US', { minimumFractionDigits:2 , maximumFractionDigits: 2 }).format(number.toFixed(4));

}
  </script>
  <!-- Hamburger Menu -->
  <!-- width: calc(100% - 256px); -->
  <script>
    var rightMenu = document.querySelector(".right-menu");
    var leftMenu = document.querySelector("#nav-bar");
    var hamburgerMenu1 = document.querySelector("#hamburger_btn1");
    var hamburgerMenu2 = document.querySelector("#hamburger_btn2");

    hamburgerMenu1.addEventListener("click", ()=>{      
      hamburgerMenu1.style.display = "none";       
      hamburgerMenu2.style.display = "inline-block";
      leftMenu.style.display = "none";  
      rightMenu.style.width = "100%"
    });
    
    hamburgerMenu2.addEventListener("click", ()=>{
      hamburgerMenu2.style.display = "none";
      hamburgerMenu1.style.display = "inline-block";
      leftMenu.style.display = "flex";   
      rightMenu.style.width = "calc(100% - 256px)";
    });
  </script>

  <!-- m-t file input -->
  <script>
    var modalKapat = document.querySelectorAll(".modal-kapat");
    var mButtons = document.querySelectorAll(".mb");
    var fileBox = document.querySelector(".file_upload");
    var cardId, fileType; // Global değişkenler

    var details = document.querySelector(".details");
    var detailsSpan = document.querySelector("#details_span");

    modalKapat.forEach(function(item) {
      item.addEventListener("click", function() {
        fileBox.style.display = "none";
      });
    });

    mButtons.forEach(function(item) {
      item.addEventListener("click", function() {
        cardId = this.closest('.card').id; // card ID'sini set eder

        switch (item.textContent) {
          case "M1":
              details.textContent = "Maliyet Dosyası";
              detailsSpan.textContent = "M1 Dosyası Seçiniz...";
              fileType = 'M_File_Card';

              break;

          case "M2":
              details.textContent = "Maliyet Dosyası";
              detailsSpan.textContent = "M2 Dosyası Seçiniz...";
              fileType = 'M_File_Card_2';

              break;

          case "M3":
              details.textContent = "Maliyet Dosyası";
              detailsSpan.textContent = "M3 Dosyası Seçiniz...";
              fileType = 'M_File_Card_3';

              break;
          case "T1":
              details.textContent = "Teklif Dosyası";
              detailsSpan.textContent = "T1 Dosyası Seçiniz...";
              fileType = 'Offer_File_Card';

              break;
          case "T2":
              details.textContent = "Teklif Dosyası";
              detailsSpan.textContent = "T2 Dosyası Seçiniz...";
              fileType = 'Offer_File_Card_2';

              break;  
          case "T3":
              details.textContent = "Teklif Dosyası";
              detailsSpan.textContent = "T3 Dosyası Seçiniz...";
              fileType = 'Offer_File_Card_3';

              break;
          case "T4":
              details.textContent = "Teklif Dosyası";
              detailsSpan.textContent = "T4 Dosyası Seçiniz...";
              fileType = 'Offer_File_Card_4';

              break;
          case "T5":
              details.textContent = "Teklif Dosyası";
              detailsSpan.textContent = "T5 Dosyası Seçiniz...";
              fileType = 'Offer_File_Card_5';

              break;         
          default:
              break;
        }      
        fileBox.style.display = "block";
      });
    });

    // document.getElementById('submit_btn').addEventListener('click', function(event) {
    //    // Normal form gönderimini engeller
    //   uploadFile(cardId, fileType); // uploadFile fonksiyonunu çağırır
    // });
    document.getElementById('submit_btn').addEventListener('click', function(event) {
    event.preventDefault(); // Normal form gönderimini engelle

    uploadFile(cardId, fileType); // uploadFile fonksiyonunu çağırır

    // 1000 milisaniye (1 saniye) sonra formu submit et
    setTimeout(function() {
        document.querySelector('#file-form').submit();
    }, 10);
});

    
    function uploadFile(cardId, fileType) {
      var formData = new FormData();
      formData.append('file', document.getElementById('id_file_up').files[0]);
      formData.append('card_id', cardId);
      formData.append('file_type', fileType);
    
      fetch('/upload_file_view/', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        console.log('Success:', data);
        // Burada başarılı yükleme sonrası kullanıcıya bilgi verilebilir
      })
      .catch(error => {
        console.error('Error:', error);
        // Burada hata durumunda kullanıcıya hata gösterilebilir
      });
    }
</script>
  <script>
    document.getElementById('id_file_up').addEventListener('change', function() {
        var fileName = this.value.split("\\").pop(); 
        document.getElementById('details_span').innerText = fileName + ' seçildi'; 
    });
</script>

<script>
  document.addEventListener("DOMContentLoaded", function() {

    rowcardss = document.querySelectorAll(".card");
    rowcardss.forEach(function(item) {
      
      let cardTarih = item.querySelector('p:nth-child(3)');
      let araziCati = item.querySelector('.boxes:nth-of-type(2) p:nth-of-type(2)');
      if(araziCati.textContent == "None"){
        araziCati.textContent = "-";
      };
      if(cardTarih.textContent == "None"){
        cardTarih.textContent = "-";
      };
    });

    // 1. row
    var rowsElement1 = document.querySelector('.rows[data-situation="Potansiyel Müşteri"]');
    var cardElements1 = rowsElement1.querySelectorAll('.card');

    var sortedCards1 = Array.from(cardElements1).sort(function(a, b) {
        var dateA = parseCardDate(a.querySelector('p:nth-child(3)').textContent); // 3. sıradaki p etiketindeki tarih
        var dateB = parseCardDate(b.querySelector('p:nth-child(3)').textContent);
        
        if (dateA === null && dateB !== null) {
            return 1; // eğer dateA None ve dateB değilse, dateA'yı dateB'den sonraya yerleştir
        } else if (dateA !== null && dateB === null) {
            return -1; // eğer dateA değil ve dateB None ise, dateA'yı dateB'den önceye yerleştir
        }

        return dateA - dateB;
    });
    for (var i = 0; i < sortedCards1.length; i++) {
        
        rowsElement1.appendChild(sortedCards1[i]);
    }
    // 2. row
    var rowsElement2 = document.querySelector('.rows[data-situation="Maliyet Hesaplama"]');
    var cardElements2 = rowsElement2.querySelectorAll('.card');

    var sortedCards2 = Array.from(cardElements2).sort(function(a, b) {
        var dateA = parseCardDate(a.querySelector('p:nth-child(3)').textContent); // 3. sıradaki p etiketindeki tarih
        var dateB = parseCardDate(b.querySelector('p:nth-child(3)').textContent);
        if (dateA === null && dateB !== null) {
            return 1; // eğer dateA None ve dateB değilse, dateA'yı dateB'den sonraya yerleştir
        } else if (dateA !== null && dateB === null) {
            return -1; // eğer dateA değil ve dateB None ise, dateA'yı dateB'den önceye yerleştir
        }
        return dateA - dateB;
    });
    for (var i = 0; i < sortedCards2.length; i++) {
        rowsElement2.appendChild(sortedCards2[i]);
    }
    // 3. row
    var rowsElement3 = document.querySelector('.rows[data-situation="Fiyat Belirleme"]');
    var cardElements3 = rowsElement3.querySelectorAll('.card');

    var sortedCards3 = Array.from(cardElements3).sort(function(a, b) {
        var dateA = parseCardDate(a.querySelector('p:nth-child(3)').textContent); // 3. sıradaki p etiketindeki tarih
        var dateB = parseCardDate(b.querySelector('p:nth-child(3)').textContent);
        if (dateA === null && dateB !== null) {
            return 1; // eğer dateA None ve dateB değilse, dateA'yı dateB'den sonraya yerleştir
        } else if (dateA !== null && dateB === null) {
            return -1; // eğer dateA değil ve dateB None ise, dateA'yı dateB'den önceye yerleştir
        }
        return dateA - dateB;
    });
    for (var i = 0; i < sortedCards3.length; i++) {
        rowsElement3.appendChild(sortedCards3[i]);
    }
    // 4. row
    var rowsElement4 = document.querySelector('.rows[data-situation="Teklif Hazırlama"]');
    var cardElements4 = rowsElement4.querySelectorAll('.card');

    var sortedCards4 = Array.from(cardElements4).sort(function(a, b) {
        var dateA = parseCardDate(a.querySelector('p:nth-child(3)').textContent); // 3. sıradaki p etiketindeki tarih
        var dateB = parseCardDate(b.querySelector('p:nth-child(3)').textContent);
        if (dateA === null && dateB !== null) {
            return 1; // eğer dateA None ve dateB değilse, dateA'yı dateB'den sonraya yerleştir
        } else if (dateA !== null && dateB === null) {
            return -1; // eğer dateA değil ve dateB None ise, dateA'yı dateB'den önceye yerleştir
        }
        return dateA - dateB;
    });
    for (var i = 0; i < sortedCards4.length; i++) {
        rowsElement4.appendChild(sortedCards4[i]);
    }
    // 5. row
    var rowsElement5 = document.querySelector('.rows[data-situation="Teklif Hazır"]');
    var cardElements5 = rowsElement5.querySelectorAll('.card');

    var sortedCards5 = Array.from(cardElements5).sort(function(a, b) {
        var dateA = parseCardDate(a.querySelector('p:nth-child(3)').textContent); // 3. sıradaki p etiketindeki tarih
        var dateB = parseCardDate(b.querySelector('p:nth-child(3)').textContent);
        if (dateA === null && dateB !== null) {
            return 1; // eğer dateA None ve dateB değilse, dateA'yı dateB'den sonraya yerleştir
        } else if (dateA !== null && dateB === null) {
            return -1; // eğer dateA değil ve dateB None ise, dateA'yı dateB'den önceye yerleştir
        }
        return dateA - dateB;
    });
    for (var i = 0; i < sortedCards5.length; i++) {
        rowsElement5.appendChild(sortedCards5[i]);
    }
    // 6. row
    var rowsElement6 = document.querySelector('.rows[data-situation="Teklif Sunuldu"]');
    var cardElements6 = rowsElement6.querySelectorAll('.card');

    var sortedCards6 = Array.from(cardElements6).sort(function(a, b) {
        var dateA = parseCardDate(a.querySelector('p:nth-child(3)').textContent); // 3. sıradaki p etiketindeki tarih
        var dateB = parseCardDate(b.querySelector('p:nth-child(3)').textContent);
        if (dateA === null && dateB !== null) {
            return 1; // eğer dateA None ve dateB değilse, dateA'yı dateB'den sonraya yerleştir
        } else if (dateA !== null && dateB === null) {
            return -1; // eğer dateA değil ve dateB None ise, dateA'yı dateB'den önceye yerleştir
        }
        return dateA - dateB;
    });
    for (var i = 0; i < sortedCards6.length; i++) {
        rowsElement6.appendChild(sortedCards6[i]);
    }
    // 7. row
    var rowsElement7 = document.querySelector('.rows[data-situation="Sunum Sonrası Görüşme"]');
    var cardElements7 = rowsElement7.querySelectorAll('.card');

    var sortedCards7 = Array.from(cardElements7).sort(function(a, b) {
        var dateA = parseCardDate(a.querySelector('p:nth-child(3)').textContent); // 3. sıradaki p etiketindeki tarih
        var dateB = parseCardDate(b.querySelector('p:nth-child(3)').textContent);
        if (dateA === null && dateB !== null) {
            return 1; // eğer dateA None ve dateB değilse, dateA'yı dateB'den sonraya yerleştir
        } else if (dateA !== null && dateB === null) {
            return -1; // eğer dateA değil ve dateB None ise, dateA'yı dateB'den önceye yerleştir
        }
        return dateA - dateB;
    });
    for (var i = 0; i < sortedCards7.length; i++) {
        rowsElement7.appendChild(sortedCards7[i]);
    }
});

function parseCardDate(dateString) {
  if (dateString == "-") {
        return null; // Eğer "None" ise, null döndür
    }
    // Özel tarih formatını işleyen bir fonksiyon ekleyin
    // Örneğin: "11 Ocak 2024" formatındaki bir tarihi aşağıdaki gibi işleyebilirsiniz.
    var months = {
        "Ocak": 0, "Şubat": 1, "Mart": 2, "Nisan": 3, "Mayıs": 4, "Haziran": 5,
        "Temmuz": 6, "Ağustos": 7, "Eylül": 8, "Ekim": 9, "Kasım": 10, "Aralık": 11
    };

    var dateParts = dateString.split(" ");
    var day = parseInt(dateParts[0]);
    var month = months[dateParts[1]];
    var year = parseInt(dateParts[2]);

    return new Date(year, month, day);
}
</script>
  

{% endblock %}
